<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Bazaar Orders — WATO API</title>
  <link rel="icon" type="image/png" href="site-icon.png"/>

  <style>
    :root {
      --card: rgba(0,0,0,0.65);
      --text: #f5f7fa;
      --border: rgba(255,255,255,0.12);
      --head: rgba(0,191,255,0.28);
      --ghost: rgba(186,114,255,0.18);
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      color: var(--text);
      background-image: url('bgimage.jpeg');
      background-size: cover;
      background-attachment: fixed;
      background-position: center;
      font-family: system-ui, Segoe UI, Roboto, sans-serif;
    }
    .container { max-width: 1200px; margin: 36px auto; padding: 0 16px; }
    .panel {
      background: var(--card); border: 1px solid var(--border);
      border-radius: 14px; padding: 16px; margin-bottom: 16px;
      backdrop-filter: saturate(120%) blur(2px);
    }
    label { display: block; margin-bottom: 6px; font-weight: bold; }
    input[type="text"] {
      width: 100%; padding: 12px; border-radius: 10px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.06);
      color: var(--text);
      font-size: 15px;
    }
    .dropdown {
      background: var(--card); border: 1px solid var(--border);
      border-radius: 10px; padding: 6px; max-height: 320px;
      overflow-y: auto; display: none; margin-top: 6px;
    }
    .dropdown-item {
      padding: 8px 10px; border-radius: 8px; cursor: pointer;
    }
    .dropdown-item:hover { background: rgba(255,255,255,0.06); }

    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
    @media (max-width: 920px) { .grid-2 { grid-template-columns: 1fr; } }

    table {
      width: 100%; border-collapse: collapse;
      border-radius: 12px; overflow: hidden;
    }
    thead th {
      background: var(--head); padding: 10px; text-align: center;
      border-bottom: 1px solid var(--border);
    }
    tbody td, tfoot td {
      padding: 10px; text-align: center;
      border-bottom: 1px solid rgba(255,255,255,0.06);
      font-size: 14px;
    }
    tr:nth-child(even) td { background: rgba(255,255,255,0.03); }
    tfoot td { font-weight: bold; background: rgba(255,255,255,0.07); }
    .highlight-ghost { background: var(--ghost) !important; }
  </style>
</head>
<body>
  <div class="container">
    <div class="panel">
      <label>Item ID</label>
      <input id="itemInput" type="text" placeholder="Enter Item ID"/>
      <div id="itemDropdown" class="dropdown"></div>
    </div>

    <div class="grid-2">
      <div class="panel">
        <h2>Buy Orders</h2>
        <table id="buyTable">
          <thead><tr><th>Orders</th><th>Amount</th><th>Unit Price</th><th>Coin Equivalent</th></tr></thead>
          <tbody></tbody>
          <tfoot><tr><td>Total:</td><td></td><td></td><td></td></tr></tfoot>
        </table>
      </div>

      <div class="panel">
        <h2>Sell Orders</h2>
        <table id="sellTable">
          <thead><tr><th>Orders</th><th>Amount</th><th>Unit Price</th><th>Coin Equivalent</th></tr></thead>
          <tbody></tbody>
          <tfoot><tr><td>Total:</td><td></td><td></td><td></td></tr></tfoot>
        </table>
      </div>
    </div>
  </div>

  <script>
  const supportedItems = [
    "BOOSTER_COOKIE",
    "RECOMBOBULATOR_3000",
    "ENCHANTED_DIAMOND_BLOCK",
    "KISMET_FEATHER",
    "SUMMONING_EYE",
    "ESSENCE_CRIMSON",
    "SKELETON_KEY",
    "TITANIC_EXP_BOTTLE"
  ];

  const itemInput = document.getElementById("itemInput");
  const itemDropdown = document.getElementById("itemDropdown");
  const buyBody = document.querySelector("#buyTable tbody");
  const sellBody = document.querySelector("#sellTable tbody");
  const buyFoot = document.querySelector("#buyTable tfoot tr");
  const sellFoot = document.querySelector("#sellTable tfoot tr");

  function populateDropdown(query) {
    const filtered = supportedItems.filter(id => id.toLowerCase().includes(query.toLowerCase()));
    itemDropdown.innerHTML = "";
    for (const id of filtered) {
      const div = document.createElement("div");
      div.className = "dropdown-item";
      div.textContent = id;
      div.onclick = () => {
        itemInput.value = id;
        itemDropdown.style.display = "none";
        loadOrders(id);
      };
      itemDropdown.appendChild(div);
    }
    itemDropdown.style.display = filtered.length ? "block" : "none";
  }

  itemInput.addEventListener("input", () => {
    const query = itemInput.value.trim();
    if (!query) { itemDropdown.style.display = "none"; return; }
    populateDropdown(query);
  });

  async function loadOrders(id) {
  // show a single loading row in both tables (optional)
  const setLoading = (tbody) => { tbody.innerHTML = `<tr><td colspan="4">Loading…</td></tr>`; };
  setLoading(buyTbody); setLoading(sellTbody);

  try {
    const res = await fetch(`https://wato-api.vercel.app/${encodeURIComponent(id)}`);
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    const data = await res.json();

    // ✅ Correct mapping:
    // API buy_summary  -> BUY table
    // API sell_summary -> SELL table
    // ✅ Correct sort:
    // BUY: expensive -> cheap (DESC)
    // SELL: cheap -> expensive (ASC)
    const buyRows = (data.buy_summary  ?? []).slice().sort((a,b) => b.pricePerUnit - a.pricePerUnit);
    const sellRows = (data.sell_summary ?? []).slice().sort((a,b) => a.pricePerUnit - b.pricePerUnit);

    renderTable(buyRows,  buyTbody,  buyTfoot);   // uses your existing renderTable
    renderTable(sellRows, sellTbody, sellTfoot);
  } catch (err) {
    console.error(err);
    const errRow = `<tr><td colspan="4">Error loading data</td></tr>`;
    buyTbody.innerHTML  = errRow;
    sellTbody.innerHTML = errRow;
    buyTfoot.innerHTML  = `<td>Total:</td><td></td><td></td><td></td>`;
    sellTfoot.innerHTML = `<td>Total:</td><td></td><td></td><td></td>`;
  }
}

  function renderTable(summary, tbody, tfootRow) {
    tbody.innerHTML = "";
    if (!summary || !summary.length) {
      tbody.innerHTML = "<tr><td colspan='4'>No data</td></tr>";
      tfootRow.innerHTML = "<td>Total:</td><td></td><td></td><td></td>";
      return;
    }
    let totalAmount = 0, totalCoins = 0;
    for (const row of summary) {
      const amount = Number(row.amount) || 0;
      const price = Number(row.pricePerUnit) || 0;
      const total = amount * price;
      totalAmount += amount;
      totalCoins += total;
      const tr = document.createElement("tr");
      if (row.ghost) tr.classList.add("highlight-ghost");
      tr.innerHTML = `
        <td>${row.orders}</td>
        <td>${amount}</td>
        <td>${price.toLocaleString()}</td>
        <td>${total.toLocaleString()}</td>
      `;
      tbody.appendChild(tr);
    }
    tfootRow.innerHTML = `
      <td>Total:</td>
      <td>${totalAmount}</td>
      <td></td>
      <td>${totalCoins.toLocaleString()}</td>
    `;
  }
  </script>
</body>
</html>
