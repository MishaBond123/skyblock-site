<!-- auth.html  â€“ replace the existing <script type="module"> with this -->
<script type="module">
  import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

  const SUPABASE_URL      = "https://dhgfmbsyndfbsretlhvm.supabase.co";
  const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRoZ2ZtYnN5bmRmYnNyZXRsaHZtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ3MzA2MDUsImV4cCI6MjA2MDMwNjYwNX0.Xy6a2BMXaEOBQV2vJrKWbivaP4tYE6nAQ8tSQG-wTZI";
  const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  /* ----------  element refs ---------- */
  const loginTab   = document.getElementById("loginTab");
  const signupTab  = document.getElementById("signupTab");
  const submitBtn  = document.getElementById("submitBtn");
  const errorMsg   = document.getElementById("errorMsg");
  const mcInput    = document.getElementById("mcUsername");
  const profileInp = document.getElementById("sbProfile");

  let isLogin = true;

  loginTab.onclick = () => {
    isLogin = true;
    loginTab.classList.add("active");
    signupTab.classList.remove("active");
    submitBtn.textContent = "Login";
    mcInput.style.display = "none";
    profileInp.style.display = "none";
  };

  signupTab.onclick = () => {
    isLogin = false;
    signupTab.classList.add("active");
    loginTab.classList.remove("active");
    submitBtn.textContent  = "Sign Up";
    mcInput.style.display  = "block";
    profileInp.style.display = "block";
  };

  /* ----------  login / sign-up ---------- */
  submitBtn.onclick = async () => {
    errorMsg.textContent = "";
    const username    = document.getElementById("username").value.trim();
    const password    = document.getElementById("password").value.trim();
    const mc_username = mcInput.value.trim();
    const sb_profile  = profileInp.value.trim();

    if (!username || !password || (!isLogin && (!mc_username || !sb_profile))) {
      errorMsg.textContent = "Please fill in all required fields.";
      return;
    }

    if (isLogin) {
      /* ---- login ---- */
      const { data, error } = await supabase
        .from("users")
        .select("*")
        .eq("username", username)
        .eq("password", password)
        .maybeSingle();

      if (error || !data) {
        errorMsg.textContent = "Invalid login credentials.";
        return;
      }

      localStorage.setItem("user_id",    data.id);
      localStorage.setItem("username",   data.username);
      localStorage.setItem("mc_username", data.mc_username ?? "");
      localStorage.setItem("sb_profile",  data.sb_profile  ?? "");
      window.location.href = "index.html";
    } else {
      /* ---- sign-up ---- */
      const { data, error } = await supabase
        .from("users")
        .insert([{ username, password, mc_username, sb_profile }])
        .select()
        .maybeSingle();

      if (error || !data) {
        errorMsg.textContent =
          "Sign-up failed: " + (error?.message || "Unknown error.");
        return;
      }

      localStorage.setItem("user_id",    data.id);
      localStorage.setItem("username",   data.username);
      localStorage.setItem("mc_username", data.mc_username);
      localStorage.setItem("sb_profile",  data.sb_profile);
      window.location.href = "index.html";
    }
  };
</script>
